<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Matris İşlemleri</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
.result-box {
    background:#f8f9fa;
    padding:20px;
    border-radius:10px;
    border:1px solid #ddd;
    margin-top:15px;
}
</style>
</head>
<body class="bg-light">

<div class="container py-5">
    <h2 class="text-center mb-4">Matris İşlemleri (Flask + NumPy)</h2>

    
    <div class="card p-3 mb-4">
        <h5>Matris Sayısı</h5>
        <select id="matrixCount" class="form-select w-25" onchange="createMatrixInputs()">
            <option value="1">1 Matris</option>
            <option value="2">2 Matris</option>
        </select>
    </div>

    
    <div class="row" id="matrixInputs"></div>

    <hr>

    
    <div class="d-flex gap-3 mb-4">
        <button class="btn btn-primary" onclick="calculate('multiply')">Matris Çarpımı</button>
        <button class="btn btn-success" onclick="calculate('transpose')">Transpoze</button>
        <button class="btn btn-warning" onclick="calculate('determinant')">Determinant</button>
        <button class="btn btn-danger" onclick="calculate('inverse')">Tersini Al</button>
    </div>

    
    <div id="resultBox" class="result-box" style="display:none"></div>
</div>

<script>
function createMatrixInputs() {
    const count = document.getElementById("matrixCount").value;
    let html = "";

    for (let i = 1; i <= count; i++) {
        html += `
        <div class="col-md-6 mb-3">
            <div class="card p-3">
                <h5>Matris ${i}</h5>
                Satır: <input class="form-control mb-2" type="number" min="1" id="r${i}" value="2">
                Sütun: <input class="form-control mb-2" type="number" min="1" id="c${i}" value="2">
                <button class="btn btn-secondary" onclick="generateMatrix(${i})">Oluştur</button>
                <div id="matrix${i}Inputs" class="mt-3"></div>
            </div>
        </div>`;
    }

    document.getElementById("matrixInputs").innerHTML = html;
}

function generateMatrix(n) {
    let r = parseInt(document.getElementById(`r${n}`).value);
    let c = parseInt(document.getElementById(`c${n}`).value);
    let html = "<table class='table table-bordered text-center'>";
    for(let i=0;i<r;i++){
        html+="<tr>";
        for(let j=0;j<c;j++){
            html+=`<td><input type="number" class="form-control" id="m${n}_${i}_${j}" value="0"></td>`;
        }
        html+="</tr>";
    }
    html+="</table>";
    document.getElementById(`matrix${n}Inputs`).innerHTML = html;
}

function getMatrix(n){
    let container = document.getElementById(`matrix${n}Inputs`);
    if(!container.innerHTML) return null;
    let r = parseInt(document.getElementById(`r${n}`).value);
    let c = parseInt(document.getElementById(`c${n}`).value);
    let M = [];
    for(let i=0;i<r;i++){
        let row=[];
        for(let j=0;j<c;j++){
            row.push(parseFloat(document.getElementById(`m${n}_${i}_${j}`).value));
        }
        M.push(row);
    }
    return M;
}

function printMatrix(M){
    if(M === null) return "";
    
    if(typeof M === 'string' || typeof M === 'number'){
        return `<b>${M}</b>`;
    }
    
    let html = "<table class='table table-bordered text-center'>";
    M.forEach(row=>{
        html+="<tr>";
        row.forEach(v=>html+=`<td>${v}</td>`);
        html+="</tr>";
    });
    html+="</table>";
    return html;
}


function calculate(op){
    const count = parseInt(document.getElementById("matrixCount").value);
    let matrices=[];
    for(let i=1;i<=count;i++){
        let M=getMatrix(i);
        if(M) matrices.push(M);
    }

    fetch("/calculate", {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({operation:op, matrices:matrices})
    })
    .then(res=>res.json())
    .then(data=>{
        const box = document.getElementById("resultBox");
        if(data.error){
            box.style.display="block";
            box.innerHTML=`<div class="alert alert-danger">${data.error}</div>`;
        } else {
            let html="";
            data.results.forEach((res,i)=>{
                html += `<h5>Matris ${i+1} Sonuç (${op})</h5>`;
                html += printMatrix(res);
            });
            box.style.display="block";
            box.innerHTML=html;
        }
    });
}


createMatrixInputs();
</script>
</body>
</html>
